# 検証ログ1
## 実施目的
Motion,damageがどれくらいダメージに影響するかを検証するため
## 実施方法
あらかじめ
```minecraftfunction:command1
/summon skeleton ~ ~ ~ {NoGravity:1b,NoAI:1b,CanPickUpLoot:0b,Health:40f,Attributes:[{Name:generic.max_health,Base:100}],UUID:[I;0,0,0,1]}
```
を実行し、対象を設置する

### 1. 対象に必ず当たる角度に「矢※1」を召喚し、対象にダメージを与える
damage:1~6
MotionX:1~10
MotionY:1~10
の合計600パターンを以下のコマンドを用いてダメージを与える
```
/execute as @e[type=skeleton,limit=1] at @s run summon arrow ~0.5 ~3 ~ {Motion:[-%MotionX%d,-%MotionY%d,0d],NoGravity:1b,damage:%damage%d}
```
または
```
/execute as @e[type=skeleton,limit=1] at @s run summon arrow ~1 ~2 ~ {Motion:[-%MotionX%d,-%MotionY%d,0d],NoGravity:1b,damage:%damage%d}
```

※1

ここで使用する「矢」は以下の条件とする

1.damageが1~6

2.Motionが[0~-10,0~-10,0]

3.NoGravityが1b(true)

※2

ここでいう必ず当たる座標というものはMotionのx,yが``x<y``の場合``~0.5,~3``とし、``x>y``の場合``~1,~2``とする

### 2. 対象のHPを計測する
以下のコマンドを実行する
```
/data get entity 0-0-0-0-1 Health
```

### 3. 対象のHPを回復する
以下のコマンドを実行する
```
/execute as @e[type=skeleton,limit=1] at @s run summon potion ~ ~ ~ {Item:{id:"minecraft:splash_potion",Count:1b,tag:{CustomPotionEffects:[{Id:7b,Amplifier:20b,Duration:2}]}}}
```

## 結果
csvLog1.csv参照
### damage = 1の場合
|motionX\Y|1|2|3|4|5|6|7|8|9|10|
|--|--|--|--|--|--|--|--|--|--|--|
|1|2※3|3|4|5|6|7|8|9|10|11|
|2|3|3|4|5|6|7|8|9|10|11|
|3|4|4|5|5|6|7|8|9|10|11|
|4|5|5|5|6|7|8|9|9|10|11|
|5|6|6|6|7|8|8|9|10|11|12|
|6|7|7|7|8|8|9|10|10|11|12|
|7|8|8|8|9|9|10|10|11|12|13|
|8|9|9|9|9|10|10|11|12|13|13|
|9|10|10|10|10|11|11|12|13|13|14|
|10|11|11|11|11|12|12|13|13|14|15|
※3：のちの検証にてデータに誤りがあることが判明したため、該当項目だけ検証をやり直し、データを置換している
### damage = 2の場合
|motionX\Y|1|2|3|4|5|6|7|8|9|10|
|--|--|--|--|--|--|--|--|--|--|--|
|1|3|5|7|9|11|13|15|17|19|21|
|2|5|6|8|9|11|13|15|17|19|21|
|3|7|8|9|10|12|14|16|18|19|21|
|4|9|9|10|12|13|15|17|18|20|22|
|5|11|11|12|13|15|16|18|19|21|23|
|6|13|13|14|15|16|17|19|20|22|24|
|7|15|15|16|17|18|19|20|22|23|25|
|8|17|17|18|18|19|20|22|23|25|26|
|9|19|19|19|20|21|22|23|25|26|27|
|10|21|21|21|22|23|24|25|26|27|29|
### damage = 3の場合
|motionX\Y|1|2|3|4|5|6|7|8|9|10|
|--|--|--|--|--|--|--|--|--|--|--|
|1|5|7|10|13|16|19|22|25|28|31|
|2|7|9|11|14|17|19|22|25|28|31|
|3|10|11|13|15|18|21|23|26|29|32|
|4|13|14|15|17|20|22|25|27|30|33|
|5|16|17|18|20|22|24|26|29|31|34|
|6|19|19|21|22|24|26|28|30|33|35|
|7|22|22|23|25|26|28|30|32|35|37|
|8|25|25|26|27|29|30|32|34|37|39|
|9|28|28|29|30|31|33|35|37|39|41|
|10|31|31|32|33|34|35|37|39|41|43|
### damage = 4の場合
|motionX\Y|1|2|3|4|5|6|7|8|9|10|
|--|--|--|--|--|--|--|--|--|--|--|
|1|6|9|13|17|21|25|29|33|37|41|
|2|9|12|15|18|22|26|30|33|37|41|
|3|13|15|17|20|24|27|31|35|38|42|
|4|17|18|20|23|26|29|33|36|40|44|
|5|21|22|24|26|29|32|35|38|42|45|
|6|25|26|27|29|32|34|37|40|44|47|
|7|29|30|31|33|35|37|40|43|46|49|
|8|33|33|35|36|38|40|43|46|49|52|
|9|37|37|38|40|42|44|46|49|51|54|
|10|41|41|42|44|45|47|49|52|54|57|
### damage = 5の場合
|motionX\Y|1|2|3|4|5|6|7|8|9|10|
|--|--|--|--|--|--|--|--|--|--|--|
|1|8|12|16|21|26|31|36|41|46|51|
|2|12|15|19|23|27|32|37|42|47|51|
|3|16|19|22|25|30|34|39|43|48|53|
|4|21|23|25|29|33|37|41|45|50|54|
|5|26|27|30|33|36|40|44|48|52|56|
|6|31|32|34|37|40|43|47|50|55|59|
|7|36|37|39|41|44|47|50|54|58|62|
|8|41|42|43|45|48|50|54|57|61|65|
|9|46|47|48|50|52|55|58|61|64|68|
|10|51|51|53|54|56|59|62|65|68|71|
### damage = 6の場合
|motionX\Y|1|2|3|4|5|6|7|8|9|10|
|--|--|--|--|--|--|--|--|--|--|--|
|1|9|14|19|25|31|37|43|49|55|61|
|2|14|17|22|27|33|38|44|50|56|62|
|3|19|22|26|30|35|41|46|52|57|63|
|4|25|27|30|34|39|44|49|54|60|65|
|5|31|33|35|39|43|47|52|57|62|68|
|6|37|38|41|44|47|51|56|60|65|70|
|7|43|44|46|49|52|56|60|64|69|74|
|8|49|50|52|54|57|60|64|68|73|77|
|9|55|56|57|60|62|65|69|73|77|81|
|10|61|62|63|65|68|70|74|77|81|85|

## 考察
以上のデータからクリティカルではない矢のダメージは
```
roundup(sqrt(Xmotion^2+Ymotion^2+Zmotion^2) * damage)
```
で求められるのではないだろうか

# 検証ログ2

## 実施目的
Motionが重力によって変わらない時、弓はどれくらいのダメージを与えられるかを検証するため

## 実施方法
あらかじめ
```minecraftfunction:command1
/summon skeleton ~ ~ ~ {NoGravity:1b,NoAI:1b,CanPickUpLoot:0b,Health:40f,Attributes:[{Name:generic.max_health,Base:100}],UUID:[I;0,0,0,1]}
```
を実行し、対象を設置する

リピートコマンドブロックを常時実行にし、
```
/data merge entity @e[type=arrow,limit=1] {NoGravity:1b,crit:0b}
```
を実行しておく

これはどんなに距離が離れてもMotionの値を変えないためであるのと、クリティカルによるダメージの振れ幅をなくすためである※4

※4
[
Arrow damage calculation : technicalminecraft - Reddit](https://www.reddit.com/r/technicalminecraft/comments/488gc9/arrow_damage_calculation/)

### 1.弓を射出
### 2.矢のnbtタグを取得する
以下のコマンドを実行する
```
/data get entity @e[limit=1,type=arrow] Motion
```
### 3. 対象のHPを計測する
以下のコマンドを実行する
```
/data get entity 0-0-0-0-1 Health
```

### 4. 対象のHPを回復する
以下のコマンドを実行する
```
/execute as @e[type=skeleton,limit=1] at @s run summon potion ~ ~ ~ {Item:{id:"minecraft:splash_potion",Count:1b,tag:{CustomPotionEffects:[{Id:7b,Amplifier:20b,Duration:2}]}}}
```

### 5. 1.で射出した矢をkillする
2では特定の矢のみ判定するので誤作動防止のためにkillする
以下のコマンドを実行する
```
/kill @e[type=arrow]
```

## 結果
検証結果が一定だったので試行回数は10とする
csvLog2.csv参照
|Xmotion|Ymotion|Zmotion|damage|
|--|--|--|--|
|0.03984109223947011d| -0.016949640444392636d| 2.756268304878535d|6
|-0.014933888532456882d| 0.016706311519685105d| 2.796888652729804d|6
|0.007472044239661015d| -0.018467468932380524d| 2.7630514251311116d|6
|0.013560701410705362d| -0.014261934977622868d| 2.722908797490185d|6
|-0.019690415755149935d| 0.010079455230098075d| 2.7372316422758107d|6
|-0.014291863087108716d| 0.0146607685764274d| 2.787279637535753d|6
|0.004091030727407964d| 0.0038877838706381476d| 2.7477753849088358d|6
|0.004243109292261723d| -0.013955263642279636d| 2.7676705777432575d|6
|6.669978619643755E-5d| 6.934295019772377E-4d| 2.783928129108345d|6
|0.036461336324090994d| 0.021393949065656864d| 2.8308679876187726d|6

## 考察

それぞれ検証ログ1の考察で示した式通りのダメージとなった
おそらく上記の式は正しいと思われる

# 検証ログ3

## 実施目的
上記と同じ検証をクリティカルがあることによってどの程度値に差が出るのか

## 実施方法
あらかじめ
```minecraftfunction:command1
/summon skeleton ~ ~ ~ {NoGravity:1b,NoAI:1b,CanPickUpLoot:0b,Health:40f,Attributes:[{Name:generic.max_health,Base:100}],UUID:[I;0,0,0,1]}
```
を実行し、対象を設置する

リピートコマンドブロックを常時実行にし、
```
/data merge entity @e[type=arrow,limit=1] {NoGravity:1b,crit:1b}
```
を実行しておく

これはどんなに距離が離れてもMotionの値を変えないためであるのと、クリティカルによるダメージの振れ幅をなくすためである※4

※4
[
Arrow damage calculation : technicalminecraft - Reddit](https://www.reddit.com/r/technicalminecraft/comments/488gc9/arrow_damage_calculation/)

細かい方法については検証ログ2を参照

## 結果
前回に合わせて試行回数は10とする
csvLog2.csv参照
|Xmotion|Ymotion|Zmotion|damage|
|--|--|--|--|
|0.014200617402662714d| 0.016426672143976955d| 2.727872402920644d|8|
|-0.01205365501573799d| -0.005588688069047201d| 2.7339051462884116d|6|
|-0.013117656206919587d| -0.002065964636673913d| 2.77398587679423d|9|
|0.03098165555648397d| -0.0021365824052767663d| 2.721906911771466d|6|
|-0.006176386572235422d| -0.019055507496347674d| 2.715957028352794d|9|
|-0.019871408319284887d| -0.010076149936400974d| 2.758760567405635d|7|
|0.023707857872080323d| -0.024622494258054572d| 2.7311343796420426d|7|
|-0.01241871001239053d| 0.005568027939651392d| 2.7382522666342695d|9|
|-0.012174161465792428d| 0.002563035734013414d| 2.7128362515014666d|10|
|0.013451229986310058d| -0.031728899371064746d| 2.7410690375651443d|7|
試行回数不足を感じたため、追加検証予定

追加検証100回
|Xmotion|Ymotion|Zmotion|damage|
|--|--|--|--|
|0.018606306803610757| -0.02356242045690009| 2.7084694937679705|7
|0.013642659744295751| -0.040333945097125644| 2.7601402525775076|9
|-0.02058296373452862| -0.0010959656499182685| 2.749805053621754|9
|0.024451753751979957| 0.011228076485056615| 2.7474832390031345|10
|-0.0033954796524185275| -0.022760894419110427| 2.757637066300662|6
|-0.0065983452609726535| -0.03154820586680192| 2.7436571724966416|8
|-0.021015927869670294| 0.025771580250454527| 2.7181074104300698|8
|-0.0020040635235416718| 0.018492738689543813| 2.6955968912737167|7
|0.03051390999928076| -0.001911669959736431| 2.715220486322469|10
|0.017696584553502| 0.015700300180349163| 2.73921962315931|6
|-0.006202471254478368| 0.003299787765504102| 2.72367121766091|6
|0.0015231033474302894| 0.06073444884549282| 2.7730851434951016|7
|-0.02588050307666031| 0.004250647058758815| 2.7691288607561373|10
|-0.019583869434461318| 0.0143039178517407| 2.700850102596853|10
|-0.008332308299853578| -0.027557785263875357| 2.731258756230813|6
|-0.014796753741182632| -0.005359219284821541| 2.7265481045370366|8
|0.035558488642029595| 0.009357697815419695| 2.731591325564629|6
|0.0023501523066653254| 0.03696369571746345| 2.749911685469318|6
|-0.017388129951268542| 0.04100379422443047| 2.782305396848516|6
|-0.00911005596336334| -0.0022224420952661784| 2.69649244555331|8
|0.020999740316005877| 0.0018610736822352357| 2.723969599933639|6
|0.012786521826131601| -0.02660371169656879| 2.7600653510875794|8
|0.015061409049200341| -0.02332164499602243| 2.7215083452274|10
|0.04544790030715607| -0.028747002341526634| 2.7428505753272217|8
|-0.009312389739639725| -0.006804937151314001| 2.74838452192988|8
|0.006299026263712685| -0.006397893567800263| 2.7330388925713747|8
|0.01480236253214563| 0.007244320547905291| 2.7462390539540866|10
|-0.0409645138008231| -0.007459797021310043| 2.729740442428021|8
|-0.004665743263944235| -0.02512312211506184| 2.6997269642927475|8
|0.008985212850498678| 0.005380853880717806| 2.7528793251145185|9
|0.01649086746205571| 0.013697994530058924| 2.72386814785808|7
|0.03677238598489487| -0.0013178276893013327| 2.7500052341044365|8
|0.017517066665594713| 0.018338690484477664| 2.7290920362517914|8
|-0.0214568742434562| -0.01588263827039336| 2.7010223190760123|9
|-0.006409349358220602| 0.006492719537419439| 2.712886695034491|6
|-0.004404319282743623| 0.0033162783532429446| 2.7165264526119848|8
|-0.011630844177612919| -0.011159550972354356| 2.7059205485465316|6
|0.00521189134439924| 4.7435215014365265E-4| 2.7495771175384167|7
|0.0010881158328324033| 0.018052253837705402| 2.7128053740596636|8
|0.013007927647839408| 0.012935998081455367| 2.7019945176189863|10
|-0.013153354821087116| -0.03321448879094261| 2.692214943107159|9
|-0.0247457036501981| 0.024022278145905424| 2.7361671985095866|8
|0.022111326590994095| 0.013557280585699216| 2.716845293209408|7
|0.012968687901505925| -0.0069194441898584565| 2.7347129133374137|7
|0.0010378678929885623| 0.0020193980833255513| 2.7551505473106728|6
|-0.009350458681945322| -0.004494117095777395| 2.8088190169449376|8
|-0.018442681048695432| 0.04527785488250818| 2.7171960790572736|9
|0.004437820718210187| 0.03172693452418908| 2.702569943760304|8
|0.020130514453063946| -0.01961917709146019| 2.69063148662645|6
|-0.007944351933325445| -0.0020150009216057495| 2.7718113870699725|8
|0.001186914217121003| -0.007295616078317086| 2.764693682233734|7
|-0.004594011342249464| 4.1792859637090814E-4| 2.762648341029918|6
|-0.004055518371030259| -0.0033650772148093658| 2.742550097643262|8
|0.014815513683838285| 0.002626406127725284| 2.735971661536568|8
|-0.010000773917568708| -0.013816463812971504| 2.710732808893076|7
|0.006018983725534623| -0.007572894590572108| 2.7212020315137884|10
|-1.3577326157626518E-4| -0.031250806315593724| 2.7788051657178103|9
|-0.026986510791430118| -0.043557351276833974| 2.7401415611634174|9
|0.010889898828023853| -0.015185398027045258| 2.771194744134869|9
|0.027448372953754897| 2.7897217467639216E-4| 2.7037401990705603|10
|-0.02401872386198946| 0.004720074921816251| 2.7509908604760227|6
|0.002454438658379857| 0.01460114865204723| 2.710172841016708|7
|-0.011633400981797083| 0.003169821726585783| 2.7220190440163172|9
|0.023931980980333476| -0.020068988040127543| 2.66829882229223|9
|-0.030035403079167435| -0.018567622812323378| 2.7609948728387965|9
|-0.01954728938013951| -0.0015509154999787146| 2.709920417220353|10
|0.0364520382575306| -0.008863055325997016| 2.753676055224074|9
|0.03858485796472342| -0.003081264462149457| 2.7374442696765477|7
|0.009927121754083114| 0.041918449346462286| 2.749449165068767|9
|0.024205119046713585| -0.024098915613529164| 2.7433380809072796|9
|-0.00916792722384425| 0.01266813428961303| 2.703526434856485|8
|-0.0028503155613938355| 0.0023600545336154486| 2.728672227496082|6
|-0.05564842729047125| 0.0074468010120456425| 2.7666797325805317|8
|-0.01394243937256021| 0.010963139640518024| 2.7969335512129057|10
|0.02744688339999857| 0.03316521095059421| 2.7525424070757865|6
|0.01314070289098584| -0.0014182363855654067| 2.692285338830374|6
|-0.030516843850643908| 0.002375103702321322| 2.6932160030452086|9
|0.030934455808982502| 0.024689328304997607| 2.7551986050618518|6
|0.007742684929338479| 0.006879762808270761| 2.7310625745410575|10
|0.012500761636233766| -0.04301193890091167| 2.7272344236968955|6
|-0.01944479410232823| -0.043453716333177295| 2.693056585664237|9
|0.03526153763574326| 0.029682870578250854| 2.7620342386054784|9
|-0.00740782954260161| 0.006225204124447213| 2.7625236831139923|6
|-0.02495185977797554| 0.019813891469723923| 2.7850575846235843|7
|-0.01678832512890359| -0.0016559714677727472| 2.7488857193374905|7
|0.01401206823868144| 0.0025784111810816003| 2.738981760843515|8
|-0.03661626650354748| -0.007054015034547845| 2.776566094444205|9
|-0.013336477467592757| -0.02471884812276063| 2.717640083321431|10
|-0.049494299554481015| -0.011335675312959046| 2.782334722448628|8
|0.018363238121886307| 0.03595353956925319| 2.71710857091877|9
|-0.013977063808561776| 0.022946525775265177| 2.77063833293472|7
|-0.0051770358493391806| -0.02668736033120625| 2.7625773295744778|9
|0.03307047326947036| 0.03240486901417447| 2.7542992244169784|8
|-0.02306368352105882| 0.023619187387576512| 2.7152295644306736|8
|0.02438413224399713| -0.024638918352130057| 2.713940447068237|6
|0.011355775909503735| -0.013599295964957646| 2.7689145561220787|7
|0.034733573920955524| -0.01598546839547576| 2.7554755290093|10

## 考察

クリティカルがfalseの時は上記の式通りになったが、クリティカルがtrueの時は上記の式+αという結果になった

今後、αについて調べていこうと思う

# 検証ログ4

## 実施目的
クリティカルによるダメージの増加が、固定値なのか、ベースダメージによって増加するのかを検証するため

## 実施方法
あらかじめ
```minecraftfunction:command1
/summon skeleton ~ ~ ~ {NoGravity:1b,NoAI:1b,CanPickUpLoot:0b,Health:40f,Attributes:[{Name:generic.max_health,Base:100}],UUID:[I;0,0,0,1]}
```
を実行し、対象を設置する

リピートコマンドブロックを常時実行にし、
```
/data merge entity @e[type=arrow,limit=1] {NoGravity:1b,crit:1b,damage:%damage%b}
```
を実行しておく

またここではdamageには1,5を入れる

### 1.弓を射出
### 2.矢のnbtタグを取得する
以下のコマンドを実行する
```
/data get entity @e[limit=1,type=arrow] Motion
```
### 3. 対象のHPを計測する
以下のコマンドを実行する
```
/data get entity 0-0-0-0-1 Health
```

### 4. 対象のHPを回復する
以下のコマンドを実行する
```
/execute as @e[type=skeleton,limit=1] at @s run summon potion ~ ~ ~ {Item:{id:"minecraft:splash_potion",Count:1b,tag:{CustomPotionEffects:[{Id:7b,Amplifier:20b,Duration:2}]}}}
```

## 結果

csvLog3.csv参照

### damage:2

試行回数100回

有効データ数98回

|ダメージ|回数|
|--|--|
|6|19|
|7|15|
|8|22|
|9|23|
|10|19|
|合計|98|

### damage:5

試行回数100回

有効データ数99回

|ダメージ|回数|
|--|--|
|14|9|
|15|10|
|16|13|
|17|9|
|18|15|
|19|9|
|20|10|
|21|4|
|22|21|
|合計|99|

## 考察
おそらく増加ダメージはベースダメージによって決定されていると思われる

しかし、パターンが見えないため追加の検証が必要と思われる

## 追加検証
damage = 10でも検証

### 結果

csvLog4.csv参照

|ダメージ|回数|
|--|--|
|28|6|
|29|10|
|30|7|
|31|10|
|32|3|
|33|3|
|34|8|
|35|7|
|36|8|
|37|8|
|38|6|
|39|7|
|40|5|
|41|5|
|42|3|
|43|4|

## 考察2
以上の実験からクリティカルによって追加されるダメージの上限は
```
ベースダメージ * 1.5 + 1
```
または
```
roundup(ベースダメージ * 1.5)
```
とする

# まとめ
以上の計算式からMinecraft Damage Calc Webで使用する弓のダメージ計算式は
```
critical = ture ? roundup(sqrt(Xmotion^2+Ymotion^2+Zmotion^2) * damage) + roundup(sqrt(Xmotion^2+Ymotion^2+Zmotion^2) * damage / 2) : roundup(sqrt(Xmotion^2+Ymotion^2+Zmotion^2) * damage)
```
とする

## 追記
```
critical = ture ? roundup(sqrt(Xmotion^2+Ymotion^2+Zmotion^2) * damage) + round(sqrt(Xmotion^2+Ymotion^2+Zmotion^2) * damage / 2) + 1 : roundup(sqrt(Xmotion^2+Ymotion^2+Zmotion^2) * damage)
```
である可能性もあり
